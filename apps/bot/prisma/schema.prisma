generator client_bot {
    provider = "prisma-client-js"
    output   = "../../../node_modules/.prisma/client"
}

generator client_web {
    provider = "prisma-client-js"
    output   = "../../../node_modules/.prisma/client"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model User {
    id          String  @id @default(cuid())
    telegramId  String  @unique
    privyUserId String?

    // Multi-chain wallet support
    evmWalletId         String? // Privy EVM wallet ID
    evmWalletAddress    String? // For Base, Arbitrum, etc.
    solanaWalletId      String? // Privy Solana wallet ID  
    solanaWalletAddress String? // For Solana

    createdAt      DateTime        @default(now())
    updatedAt      DateTime        @updatedAt
    trades         Trade[]
    positions      Position[]
    fundingIntents FundingIntent[]
    loginTokens    LoginToken[]
}

model LoginToken {
    id        String   @id @default(cuid())
    token     String   @unique
    userId    String
    user      User     @relation(fields: [userId], references: [id])
    expiresAt DateTime
    createdAt DateTime @default(now())
}

model Signal {
    id          String   @id @default(cuid())
    asset       String
    timeframe   String
    side        String
    entry       Decimal  @db.Decimal(38, 18)
    sl          Decimal  @db.Decimal(38, 18)
    tp          Decimal  @db.Decimal(38, 18)
    notionalUsd Decimal  @db.Decimal(38, 2)
    leverage    Int
    score       Int
    features    Json
    explanation String?
    status      String   @default("sent")
    createdAt   DateTime @default(now())
}

model Trade {
    id          String   @id @default(cuid())
    user        User     @relation(fields: [userId], references: [id])
    userId      String
    signalId    String?
    asset       String
    side        String
    notionalUsd Decimal  @db.Decimal(38, 2)
    leverage    Int
    orderRef    String?
    status      String   @default("pending")
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt
}

model Position {
    id         String   @id @default(cuid())
    user       User     @relation(fields: [userId], references: [id])
    userId     String
    asset      String
    side       String
    size       Decimal  @db.Decimal(38, 18)
    entryPrice Decimal  @db.Decimal(38, 18)
    pnlUnreal  Decimal  @db.Decimal(38, 18)
    status     String   @default("open")
    createdAt  DateTime @default(now())
    updatedAt  DateTime @updatedAt
}

model FundingIntent {
    id          String   @id @default(cuid())
    user        User     @relation(fields: [userId], references: [id])
    userId      String
    sourceChain String // 'solana' | 'base'
    token       String // 'USDC'
    amount      Decimal  @db.Decimal(38, 2)
    status      String   @default("pending")
    createdAt   DateTime @default(now())
}
