generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model User {
    id            String     @id @default(cuid())
    telegramId    String     @unique
    privyUserId   String?
    walletAddress String?
    createdAt     DateTime   @default(now())
    updatedAt     DateTime   @updatedAt
    trades        Trade[]
    positions     Position[]
}

model Signal {
    id          String   @id @default(cuid())
    asset       String
    timeframe   String
    side        String
    entry       Decimal  @db.Decimal(38, 18)
    sl          Decimal  @db.Decimal(38, 18)
    tp          Decimal  @db.Decimal(38, 18)
    notionalUsd Decimal  @db.Decimal(38, 2)
    leverage    Int
    score       Int
    features    Json
    explanation String?
    status      String   @default("sent")
    createdAt   DateTime @default(now())
}

model Trade {
    id          String   @id @default(cuid())
    user        User     @relation(fields: [userId], references: [id])
    userId      String
    signalId    String?
    asset       String
    side        String
    notionalUsd Decimal  @db.Decimal(38, 2)
    leverage    Int
    orderRef    String?
    status      String   @default("pending")
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt
}

model Position {
    id         String   @id @default(cuid())
    user       User     @relation(fields: [userId], references: [id])
    userId     String
    asset      String
    side       String
    size       Decimal  @db.Decimal(38, 18)
    entryPrice Decimal  @db.Decimal(38, 18)
    pnlUnreal  Decimal  @db.Decimal(38, 18)
    status     String   @default("open")
    createdAt  DateTime @default(now())
    updatedAt  DateTime @updatedAt
}
